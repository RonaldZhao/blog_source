# Redis 深度历险：核心原理与应用实践

> 原文链接: [Redis 深度历险：核心原理与应用实践]()

::: warning 说明
本文只是作文本人的读书笔记/抄录, 目的是加深阅读印象, 所以请不要误会的认为是抄袭或搬运. 谢谢!
:::

## 1. 开篇：授人以鱼不若授人以渔 —— Redis 可以用来做什么？

`Redis(Remote Dictionary Service)`是互联网技术领域使用最为广泛的存储中间件. `Redis`以其超高的性能, 完美的文档, 简洁易懂的源码和丰富的客户端库支持在开源中间件领域广受好评. 可以说, 对`Redis`的了解和应用实践已成为当下中高级后端开发者的必备技能.

### 由 Redis 面试想到的

在面试后端工程师`Redis`技能的时候, 面试官通常问的第一个问题就是"Redis能用来做什么?", 第一个回答往往都是"缓存". 确实, 缓存确实是`Redis`使用最多的领域, 同时它相比`Memcache`而言更加易于理解, 使用和控制.

但是如果再进一步问"还有呢?", 大多数同学就会开始皱眉头，只有一小部分人会回答"分布式锁". 如果就分布式锁再深入问下去, 他们基本就会开始摇头: 我们项目里面`Redis`的锁方法都是别人(应该是架构师)封装好的, 拿过来直接使用, 内部细节没有去了解过, 也没有必要了解.

从这样的面试经历可以看出: 架构师的技能很高, 对提升团队研发效率很由帮助, 我们非常钦佩和仰慕. 但是普通开发者如果习惯于在架构师封装好的东西之上, 只专注于做业务开发, 那久而久之, 在技术理解和成长上就会变得迟钝甚至麻木. 从这个角度看, 架构师也可能成为普通开发者的"敌人", 他强大的能力会让大家成为"温室的花朵", 一旦遇到环境变化就会不知所措.

其实很多业务场景, 如果是仅仅会使用某项技术, 框架, 那是再简单不过了. 但随着业务发展, 系统的用户量, 并发量涨上来之后, 现有系统的问题就会层出不穷的暴露出来. 如果不能深入地了解系统, 技术和框架背后的深层原理, 很多问题根本无法理解到本质, 更谈不上解决, 临时抱佛脚也于事无补.

### Redis 可以做什么?

`Redis`的业务应用范围十分广泛, 这里以[掘进技术社区](https://juejin.im/)的帖子模块为实例梳理一下`Redis`可以应用在哪些地方:

1. 记录帖子的点赞数, 评论数和点击数(hash).
2. 记录用户的帖子ID列表(排序), 便于快速显示用户的帖子列表(zset).
3. 记录帖子的标题, 摘要, 作者和封面信息, 用户列表页展示(hash).
4. 记录帖子的点赞用户ID列表, 评论ID列表, 用于显示和去重计数(zset).
5. 缓存近期热帖内容(帖子内容空间占用较大), 减少数据库压力(hash).
6. 记录帖子的相关文章ID, 根据内容推荐相关帖子(list).
7. 如果帖子ID是整数自增的, 可以使用`Redis`来分配帖子ID(计数器).
8. 收藏集和帖子之间的关系(zset).
9. 记录热榜帖子ID列表, 总热榜和分类热榜(zset).
10. 缓存用户行为历史, 进行恶意行为过滤(zset, hash).

当然, 实际情况下需求可能也没这么多, 因为在请求压力不大的情况下, 很多数据都是可以直接从数据库中查询的, 但请求压力一大, 以前通过数据库直接存取的数据则必须要挪到缓存里来.

以上提到的只是`Redis`的基础应用, 也是日常开发中最常见的应用(如果你的`Redis`基础和经验不足, 可能需要阅读完下一节之后才能回过头来思考这个问题). 除了基础应用之外, 还有很多其他的`Redis`高级应用, 后面会陆续讲解到.

> 拓展阅读: [天下无难试之Redis面试刁难大全](https://mp.weixin.qq.com/s/-y1zvqWEJ3Tt4h39Z0WBJg)

## 2. 基础：万丈高楼平地起 —— Redis 基础数据结构

::: tip 本节目标
快速理解并掌握`Redis`的基础知识.
:::

### Redis 安装

::: warning OS 需求
体验`Redis`需要使用`Linux`或`Mac`环境, `Windows`可以考虑使用使用虚拟机或`Docker`.
:::

下面介绍三种体验方式:

1. Docker 方式:

```bash
$ # 首先拉取 redis 镜像
$ docker pull redis
$ # 运行 redis 容器
$ docker run --name myredis -d -p6379:6379 redis
$ # 执行容器中的 redis-cli, 然后就可以直接使用命令操作 redis
$ docker exec -it myredis redis-cli
$ # 其他有用的命令
$ docker ps -a  # 显示所有容器的状态
$ docker stop myredis  # 停止 myredis 容器，会保存状态(比如设置了一个 set ronald 666，下次 get ronald 还会得到 666)
$ docker start myredis  # 启动 myredis 容器，会保留之前的状态
$ docker exec -it myredis redis-server --version  # 查看 redis 的版本
$ docker rm myredis  # 删除名为 myredis 的容器
```

2. 直接安装

```bash
$ # Mac
$ brew install redis
$ # Ubuntu
$ sudo apt install redis
$ # redhat
$ sudo yum install redis
$ # 运行客户端
$ redis-cli  # 如果 server 没启动则要先执行 redis-server
```

3. 在线体验: [传送门](https://try.redis.io/)

### Redis 基础数据结构
